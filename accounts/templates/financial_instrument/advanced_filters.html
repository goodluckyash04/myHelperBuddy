<!-- Advanced Filters for Finance - Themed Version -->
<div class="container-fluid px-4 py-3">
  <div class="card shadow-sm border-0" style="background: linear-gradient(135deg, #FFFFFF 0%, #F8F9FA 100%);">
    <div class="card-body p-4">
      <!-- Filter Header -->
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 style="color: var(--primary); font-family: 'Dancing Script'; margin: 0;">
          <i class="fa-solid fa-sliders"></i> Filters
        </h5>
        <a href="/finance-details?status=Open" class="btn btn-sm btn-outline-secondary">
          <i class="fa-solid fa-rotate-right"></i> Reset
        </a>
      </div>

      <!-- Filter Controls Row -->
      <div class="row g-3">
        <!-- Type Filter Chips -->
        <div class="col-lg-5">
          <label class="form-label text-muted small fw-bold mb-2">
            <i class="fa-solid fa-shapes"></i> Type
          </label>
          <div class="btn-group w-100" role="group">
            <input type="radio" class="btn-check" name="typeFilter" id="typeAll" value="" {% if not request.GET.type %}checked{% endif %} onchange="applyFilters()">
            <label class="btn btn-outline-secondary btn-sm" for="typeAll">All</label>
            
            <input type="radio" class="btn-check" name="typeFilter" id="typeLoan" value="Loan" {% if request.GET.type == 'Loan' %}checked{% endif %} onchange="applyFilters()">
            <label class="btn btn-sm" for="typeLoan" style="border: 1px solid #8B5CF6; color: #8B5CF6; background: white;">
              <i class="fa-solid fa-landmark"></i> Loans
            </label>
            
            <input type="radio" class="btn-check" name="typeFilter" id="typeSIP" value="SIP" {% if request.GET.type == 'SIP' %}checked{% endif %} onchange="applyFilters()">
            <label class="btn btn-outline-success btn-sm" for="typeSIP">
              <i class="fa-solid fa-chart-line"></i> SIPs
            </label>
            
            <input type="radio" class="btn-check" name="typeFilter" id="typeSplit" value="Split" {% if request.GET.type == 'Split' %}checked{% endif %} onchange="applyFilters()">
            <label class="btn btn-outline-warning btn-sm" for="typeSplit">
              <i class="fa-solid fa-bolt"></i> Splits
            </label>
          </div>
        </div>

        <!-- Status Filter -->
        <div class="col-lg-3 col-md-6">
          <label class="form-label text-muted small fw-bold mb-2">
            <i class="fa-solid fa-toggle-on"></i> Status
          </label>
          <select class="form-select form-select-sm" id="statusFilterSelect" onchange="applyFilters()">
            <option value="Open" {% if request.GET.status == 'Open' or not request.GET.status %}selected{% endif %}>ðŸŸ¢ Open</option>
            <option value="Closed" {% if request.GET.status == 'Closed' %}selected{% endif %}>âšª Closed</option>
            <option value="" {% if request.GET.status == '' %}selected{% endif %}>All Status</option>
          </select>
        </div>

        <!-- Sort Options -->
        <div class="col-lg-4 col-md-6">
          <label class="form-label text-muted small fw-bold mb-2">
            <i class="fa-solid fa-arrow-down-short-wide"></i> Sort By
          </label>
          <select class="form-select form-select-sm" id="sortSelect" onchange="applyFilters()">
            <option value="started_on" {% if request.GET.sort == 'started_on' or not request.GET.sort %}selected{% endif %}>Start Date (Oldest First)</option>
            <option value="-started_on" {% if request.GET.sort == '-started_on' %}selected{% endif %}>Start Date (Newest First)</option>
            <option value="name" {% if request.GET.sort == 'name' %}selected{% endif %}>Name (A to Z)</option>
            <option value="-name" {% if request.GET.sort == '-name' %}selected{% endif %}>Name (Z to A)</option>
            <option value="amount" {% if request.GET.sort == 'amount' %}selected{% endif %}>Amount (Low to High)</option>
            <option value="-amount" {% if request.GET.sort == '-amount' %}selected{% endif %}>Amount (High to Low)</option>
          </select>
        </div>
      </div>

      <!-- Active Filters & Results Count -->
      <div class="mt-3 pt-3 border-top">
        <div class="d-flex justify-content-between align-items-center flex-wrap">
          <!-- Active Filters -->
          <div class="d-flex gap-2 flex-wrap align-items-center">
            {% if request.GET.type or request.GET.status != 'Open' or request.GET.sort %}
              <small class="text-muted fw-bold">Active:</small>
              {% if request.GET.type %}
                <span class="badge px-2 py-1" style="background: {% if request.GET.type == 'Loan' %}#8B5CF6{% elif request.GET.type == 'SIP' %}#10B981{% else %}#F59E0B{% endif %};">
                  {{ request.GET.type }}
                  <a href="?status=Open{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}" class="text-white text-decoration-none ms-1">Ã—</a>
                </span>
              {% endif %}
              {% if request.GET.status and request.GET.status != 'Open' %}
                <span class="badge bg-info text-dark px-2 py-1">
                  Status: {{ request.GET.status }}
                  <a href="?status=Open{% if request.GET.type %}&type={{ request.GET.type }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}" class="text-dark text-decoration-none ms-1">Ã—</a>
                </span>
              {% endif %}
              {% if request.GET.sort and request.GET.sort != 'started_on' %}
                <span class="badge bg-secondary px-2 py-1">
                  Sorted
                  <a href="?status=Open{% if request.GET.type %}&type={{ request.GET.type }}{% endif %}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}" class="text-white text-decoration-none ms-1">Ã—</a>
                </span>
              {% endif %}
            {% endif %}
          </div>
          
          <!-- Results Count -->
          <div>
            <small class="text-muted">
              <i class="fa-solid fa-list"></i>
              <strong style="color: var(--primary);">{{ details|length }}</strong> result{{ details|length|pluralize }}
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
/* Active button styles */
.btn-check:checked + .btn-outline-secondary {
  background: var(--primary);
  border-color: var(--primary);
  color: white;
}

.btn-check:checked + .btn-outline-success {
  background: #10B981;
  border-color: #10B981;
  color: white;
}

.btn-check:checked + .btn-outline-warning {
  background: #F59E0B;
  border-color: #F59E0B;
  color: white;
}

.btn-check:checked + label[style*="#8B5CF6"] {
  background: #8B5CF6 !important;
  color: white !important;
}

/* Form controls */
.form-select-sm, .form-select {
  border-color: #DEE2E6;
  transition: border-color 0.15s ease-in-out;
}

.form-select-sm:focus, .form-select:focus {
  border-color: var(--primary);
  box-shadow: 0 0 0 0.2rem rgba(var(--primary-rgb), 0.25);
}
</style>

<script>
function applyFilters() {
  const type = document.querySelector('input[name="typeFilter"]:checked').value;
  const status = document.getElementById('statusFilterSelect').value || 'Open';  // Default to Open
  const sort = document.getElementById('sortSelect').value;
  const search = new URLSearchParams(window.location.search).get('search') || '';
  
  let url = window.location.pathname + '?';
  const params = [];
  
  if (type) params.push(`type=${type}`);
  params.push(`status=${status}`);  // Always include status
  if (sort) params.push(`sort=${sort}`);
  if (search) params.push(`search=${search}`);
  
  window.location.href = url + params.join('&');
}
</script>
