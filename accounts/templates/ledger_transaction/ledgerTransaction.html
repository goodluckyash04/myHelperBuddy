{% extends 'header.html' %} {% load static %} {% block body %}

<div class="container mt-3">
  <div class="row">
    <div class="col-12 col-md-5">
      <h6 class="fs-3" id="key" style="color: var(--primary);">{{ counter_party }}</h6>
    </div>
    <div class="col-12 col-md-7">
      <form class="d-flex flex-wrap align-items-center gap-3" action="/ledger-transaction/{{ counter_party }}" method="get">
        
        <!-- Date Range Filters -->
        <div class="d-flex gap-2">
          <div class="input-group">
            <input type="date" class="form-control rounded-pill" value="{{ query.start }}" id="start_d" name="start_d" title="Start Date" placeholder="Start Date">
          </div>
          <div class="input-group">
            <input type="date" class="form-control rounded-pill" value="{{ query.end }}" id="end_d" name="end_d" title="End Date" placeholder="End Date">
          </div>
        </div>
        
        <!-- Search Bar -->
        <div class="d-flex">
          <div class="input-group">
            <input class="form-control rounded-pill" value="{{ query.search }}" type="search" name="search" placeholder="Search Transactions" aria-label="Search" title="Search Transactions">
          </div>
        </div>
    
        <!-- Action Buttons -->
        <div class="d-flex gap-2">
          <button class="btn custom-btn-primary rounded-pill" type="submit" title="Search">
            <i class="fa-solid fa-magnifying-glass"></i> 
          </button>
          <a href="/ledger-transaction/{{ counter_party }}" class="btn custom-btn-danger rounded-pill" role="button" title="Clear Filters">
            <i class="fa-solid fa-eraser"></i> 
          </a>
        </div>
    
      </form>
    </div>
    
    
  </div>

  <div class="row mt-3 mx-2">
    <div class="col-12 d-flex justify-content-between mb-3">
      <a href="/ledger-transaction-details/" class="btn custom-btn-primary btn-sm rounded-pill fw-bold">
         <i class="fa-solid fa-arrow-left me-2"></i> Ledger Summary
      </a>
      <a href="/deleted-ledger-transaction/" class="btn btn-outline-danger btn-sm rounded-pill fw-bold">
         Deleted Txn <i class="fa-solid fa-arrow-right ms-2"></i>
      </a>
    </div>

    <!-- Ledger Table Card -->
    <div class="card border-0 shadow-sm p-0 mb-4" style="border-radius: 12px; overflow: hidden;">
      <form method="POST" action="/update-ledger-transaction-status/" class="p-0">
        {% csrf_token %}
        <div class="table-responsive" style="max-height: 70vh;">
          <table id='myTable' class="table table-hover align-middle mb-0">
            <thead class="bg-light sticky-top" style="z-index: 1;">
              <tr>
                <th class="ps-3" width="40"><input type="checkbox" class="form-check-input" id="select-all-checkbox"></th>
                <th class="text-secondary text-uppercase fw-bold" style="font-size: 0.75rem;">#</th>
                <th class="text-secondary text-uppercase fw-bold" style="font-size: 0.75rem;">Type</th>
                <th class="text-center text-secondary text-uppercase fw-bold" style="font-size: 0.75rem;">
                  Status
                  <button type="submit" class="border-0 bg-transparent p-0 ms-1" title="Mark Selected as Complete">
                    <i class="fa-solid fa-check-circle text-primary"></i>
                  </button>
                </th>
                <th class="text-secondary text-uppercase fw-bold" style="font-size: 0.75rem;">Date</th>
                <th class="text-end text-secondary text-uppercase fw-bold" style="font-size: 0.75rem;">Amount (â‚¹)</th>
                <th class="text-secondary text-uppercase fw-bold" style="font-size: 0.75rem;">Completed On</th>
                <th class="text-secondary text-uppercase fw-bold" style="font-size: 0.75rem;">Description</th>
                <th class="text-center text-secondary text-uppercase fw-bold" style="font-size: 0.75rem;">Actions</th>
              </tr>
            </thead>
            <tbody class="border-top-0">
              {% if transaction_data %}
                {% for i in transaction_data %}
                  <tr>
                    <td class="ps-3"><input type="checkbox" class="form-check-input" name="record_ids" value="{{ i.id }}"></td>
                    <td class="text-muted">{{ forloop.counter }}</td>
                    <td>
                      <a href="#" data-bs-toggle="modal" class="text-decoration-none fw-bold" 
                         style="color: var(--primary);" 
                         data-bs-target="#ledgerModal" 
                         onclick="openModalAndGetLedger({{ i.id }})">
                         {{ i.transaction_type }}
                      </a>
                    </td>
                    <td class="text-center">
                      <a href="/update-ledger-transaction-status/{{ i.id }}" class="text-decoration-none" title="Toggle Status">
                        {% if i.status == 'Completed' %}
                          <span class="badge bg-soft-success text-success rounded-pill px-2">
                            <i class="fa-solid fa-check me-1"></i> Paid
                          </span>
                        {% else %}
                          <span class="badge bg-soft-warning text-warning rounded-pill px-2">
                            <i class="fa-solid fa-clock me-1"></i> Pending
                          </span>
                        {% endif %}
                      </a>
                    </td>
                    <td><span class="text-dark fw-medium">{{ i.transaction_date|date:"d M Y" }}</span></td>
                    <td class="text-end fw-bold font-monospace" style="color:{% if i.transaction_type == 'Receivable' or i.transaction_type == 'Received' %}#17a2b8{% else %}#fd7e14{% endif %}">
                      {{ i.amount }}
                    </td>
                    <td>
                      {% if i.status == 'Completed' %}
                        <span class="text-muted small">{{ i.completion_date|date:"d M Y" }}</span>
                      {% else %}
                        <span class="text-muted small">-</span>
                      {% endif %}
                    </td>
                    <td class="text-muted small">{{ i.description|default:"-" }}</td>
                    <td class="text-center">
                      <button 
                        type="button" 
                        class="btn btn-sm btn-icon btn-ghost-danger rounded-circle"
                        data-bs-toggle="modal" 
                        data-bs-target="#confirmModal" 
                        title="Delete Transaction"
                        data-url="/delete-ledger-transaction/{{ i.id }}">
                        <i class="fa-solid fa-trash-can"></i> 
                      </button>
                    </td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="9" class="text-center py-5 text-muted">
                    <i class="fa-solid fa-file-invoice fa-3x mb-3 opacity-50"></i>
                    <p>No transactions found for this period</p>
                  </td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </form>
    </div>
  </div>

<style>
    .bg-soft-success { background-color: rgba(16, 185, 129, 0.1) !important; }
    .bg-soft-warning { background-color: rgba(245, 158, 11, 0.1) !important; }
    .btn-ghost-danger { color: #dc3545; transition: all 0.2s; }
    .btn-ghost-danger:hover { background-color: rgba(220, 53, 69, 0.1); }
    .table thead th { border-bottom: 2px solid #edf2f9; }
</style>

  {% include 'ledger_transaction/ledgerTransactionModal.html' %}

  {% include 'utility/confirmation_modal.html' with title='Confirm Delete' body='Are you sure you want to delete this transaction?' confirmButton='Delete' %}


</div>

{% endblock body %}

{% block script %}
<script src="{% static 'js/ledger.js' %}"></script>
<script src="{% static 'js/utilityFunction.js' %}"></script>
{% endblock script %}
