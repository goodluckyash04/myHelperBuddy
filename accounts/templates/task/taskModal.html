{% load static %}

<!-- Enhanced Add/Edit Task Modal -->
<div class="modal fade" id="taskmodal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-4" id="exampleModalLabel">Add Task</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form action="/addTask/" method="post" id="myTaskForm">
            {% csrf_token %}
            
            <div class="row">
              <!-- Left Column -->
              <div class="col-md-6">
                <!-- Task Title -->
                <div class="mb-3">
                  <label for="title" class="form-label">
                    <i class="fa-solid fa-heading text-primary"></i> Task Title <span class="text-danger">*</span>
                  </label>
                  <input
                    type="text"
                    class="form-control shadow-sm"
                    name="name"
                    id="title"
                    placeholder="Enter task title"
                    required
                  />
                </div>

                <!-- Priority Selection -->
                <div class="mb-3">
                  <label for="priority" class="form-label">
                    <i class="fa-solid fa-flag text-warning"></i> Priority
                  </label>
                  <select class="form-select shadow-sm" name="priority" id="priority" aria-label="Select task priority">
                    <option value="Medium" selected>Medium</option>
                    <option value="High">üî¥ High</option>
                    <option value="Low">üü¢ Low</option>
                  </select>
                </div>

                <!-- Category Selection -->
                <div class="mb-3">
                  <label for="category" class="form-label">
                    <i class="fa-solid fa-folder text-info"></i> Category
                  </label>
                  <select class="form-select shadow-sm" name="category" id="category" aria-label="Select category">
                    <option value="">-- No Category --</option>
                    {% for cat in categories %}
                      <option value="{{ cat.id }}" data-color="{{ cat.color }}">
                        {{ cat.icon|default:"üìÅ" }} {{ cat.name }}
                      </option>
                    {% endfor %}
                  </select>
                  <small class="text-muted">Organize tasks by project or area</small>
                </div>

                <!-- Tags Selection -->
                <div class="mb-3">
                  <label for="tags" class="form-label">
                    <i class="fa-solid fa-tags text-success"></i> Tags
                  </label>
                  <select class="form-select shadow-sm" name="tags" id="tags" multiple aria-label="Select tags">
                    {% for tag in tags %}
                      <option value="{{ tag.id }}" data-color="{{ tag.color }}">{{ tag.name }}</option>
                    {% endfor %}
                  </select>
                  <small class="text-muted">Hold Ctrl to select multiple tags</small>
                </div>
              </div>

              <!-- Right Column -->
              <div class="col-md-6">
                <!-- Start Date -->
                <div class="mb-3">
                  <label for="start_date" class="form-label">
                    <i class="fa-solid fa-calendar-plus text-secondary"></i> Start Date
                  </label>
                  <input
                    type="date"
                    class="form-control shadow-sm"
                    name="start_date"
                    id="start_date"
                    aria-describedby="start_date"
                  />
                </div>

                <!-- Due Date -->
                <div class="mb-3">
                  <label for="complete_by" class="form-label">
                    <i class="fa-solid fa-calendar-check text-danger"></i> Due Date
                  </label>
                  <input
                    type="date"
                    class="form-control shadow-sm"
                    name="complete_by_date"
                    id="complete_by"
                    onchange="dateCheck()"
                    aria-describedby="complete_by"
                  />
                </div>

                <!-- Estimated Hours -->
                <div class="mb-3">
                  <label for="estimated_hours" class="form-label">
                    <i class="fa-solid fa-clock text-warning"></i> Estimated Hours
                  </label>
                  <input
                    type="number"
                    class="form-control shadow-sm"
                    name="estimated_hours"
                    id="estimated_hours"
                    placeholder="e.g., 2.5"
                    step="0.5"
                    min="0"
                    max="999"
                  />
                  <small class="text-muted">How long will this take?</small>
                </div>

                <!-- Status (for edit mode) -->
                <div class="mb-3" id="statusField" style="display: none;">
                  <label for="status" class="form-label">
                    <i class="fa-solid fa-circle-check text-success"></i> Status
                  </label>
                  <select class="form-select shadow-sm" name="status" id="status">
                    <option value="Pending">‚è≥ Pending</option>
                    <option value="In Progress">üîÑ In Progress</option>
                    <option value="Completed">‚úÖ Completed</option>
                    <option value="Cancelled">‚ùå Cancelled</option>
                  </select>
                </div>

                <!-- Recurring Pattern -->
                <div class="mb-3">
                  <label for="recurring_frequency" class="form-label">
                    <i class="fa-solid fa-rotate text-info"></i> Recurring
                  </label>
                  <div class="row g-2">
                    <div class="col-8">
                      <select class="form-select form-select-sm" name="recurring_frequency" id="recurring_frequency">
                        <option value="">-- Not Recurring --</option>
                        <option value="daily">üìÖ Daily</option>
                        <option value="weekly">üìÜ Weekly</option>
                        <option value="monthly">üóìÔ∏è Monthly</option>
                        <option value="yearly">üéÇ Yearly</option>
                      </select>
                    </div>
                    <div class="col-4">
                      <input type="number" class="form-control form-control-sm" name="recurring_interval" id="recurring_interval" 
                             placeholder="Every" min="1" max="30" value="1">
                    </div>
                  </div>
                  <small class="text-muted">E.g., "Weekly" + "2" = Every 2 weeks</small>
                </div>

                <!-- Parent Task (for subtasks) -->
                <div class="mb-3">
                  <label for="parent_task" class="form-label">
                    <i class="fa-solid fa-diagram-project text-secondary"></i> Parent Task
                  </label>
                  <select class="form-select shadow-sm" name="parent_task" id="parent_task">
                    <option value="">-- No Parent (Main Task) --</option>
                    {% for task in all_tasks %}
                      <option value="{{ task.id }}">
                        {% if task.category %}{{ task.category.icon|default:"üìã" }}{% else %}üìã{% endif %} {{ task.name|truncatewords:8 }}
                      </option>
                    {% endfor %}
                  </select>
                  <small class="text-muted">Make this a subtask of another task</small>
                </div>
              </div>
            </div>

            <!-- Task Description (Full Width) -->
            <div class="mb-3">
              <label for="descirption" class="form-label">
                <i class="fa-solid fa-align-left text-primary"></i> Description
              </label>
              <textarea
                class="form-control shadow-sm"
                name="description"
                id="descirption"
                placeholder="Enter task details and notes..."
                rows="4"
              ></textarea>
            </div>

            <!-- Submit Button -->
            <div class="d-flex justify-content-end gap-2">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                <i class="fa-solid fa-times"></i> Cancel
              </button>
              <button
                type="submit"
                id="submitbutton"
                class="btn custom-btn-primary shadow-sm"
              >
                <i class="fa-solid fa-plus-circle"></i> Add Task
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Set today's date as the default value for the start date field
    document.getElementById('start_date').value = new Date().toISOString().split('T')[0];
    
    // Set tomorrow as default due date
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    document.getElementById('complete_by').value = tomorrow.toISOString().split('T')[0];
  </script>
  <script src="{% static 'js/task.js' %}"></script>
  